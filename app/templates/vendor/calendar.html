{% extends "base.html" %}
{% block title %}Attendance Calendar{% endblock %}
{% block content %}
<div class="row">
    <div class="col-md-12">
        <h2><i class="fas fa-calendar"></i> Attendance Calendar</h2>
    </div>
</div>

<!-- Month and Year Selector Form -->
<div class="row mb-3">
    <div class="col-md-12">
        <form method="GET" action="{{ url_for('vendor.calendar_view') }}" class="d-flex align-items-center gap-2">
            <label for="month" class="form-label mb-0">Month:</label>
            <select name="month" id="month" class="form-select" style="width: auto;">
                {% for i in range(1, 13) %}
                    <option value="{{ i }}" {% if i == calendar_data.month %}selected{% endif %}>{{ i }}</option>
                {% endfor %}
            </select>

            <label for="year" class="form-label mb-0">Year:</label>
            <select name="year" id="year" class="form-select" style="width: auto;">
                {% for y in year_options %}
                    <option value="{{ y }}" {% if y == calendar_data.year %}selected{% endif %}>{{ y }}</option>
                {% endfor %}
            </select>

            <button type="submit" class="btn btn-primary">Go</button>
        </form>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <a href="{{ url_for('vendor.calendar_view', year=prev_year, month=prev_month) }}" class="btn btn-outline-light">
                        <i class="fas fa-chevron-left"></i> Previous
                    </a>
                    <h4>{{ calendar_data.month_name }} {{ calendar_data.year }}</h4>
                    <a href="{{ url_for('vendor.calendar_view', year=next_year, month=next_month) }}" class="btn btn-outline-light">
                        Next <i class="fas fa-chevron-right"></i>
                    </a>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-bordered mb-0">
                        <thead class="bg-light">
                            <tr>
                                <th>Sun</th><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for week in calendar_data.calendar %}
                            <tr>
                                {% for day in week %}
                                {% set date_str = "%04d-%02d-%02d"|format(calendar_data.year, calendar_data.month, day) %}
                                {% set is_holiday = holidays.get(date_str) %}
                                {% set is_weekend = weekends and (date_str in weekends) %}
                                <td class="p-2{% if is_holiday %} calendar-day holiday{% endif %}{% if is_weekend %} calendar-day weekend{% endif %}" style="height: 100px; width: 14.28%; vertical-align: top;">
                                    {% if day != 0 %}
                                        <div class="fw-bold">{{ day }}</div>
                                        {% if is_holiday %}
                                            <div class="holiday-name text-danger mt-1">
                                                <i class="fas fa-gift"></i> {{ holidays[date_str] }}
                                            </div>
                                        {% endif %}
                                        {% if attendance_map.get(date_str) %}
                                            {% set attendance = attendance_map[date_str] %}
                                            <div class="mt-1">
                                                <small title="{{ attendance.status }}" class="badge bg-{{ 'success' if attendance.approval_status == 'Approved' else 'warning' if attendance.approval_status == 'Pending' else 'danger' }}">
                                                    {{ attendance.status }}
                                                </small>
                                            </div>
                                        {% endif %}
                                    {% endif %}
                                </td>
                                {% endfor %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Legend -->
<div class="row mt-3">
    <div class="col-md-12">
        <div class="card">
            <div class="card-body">
                <h6>Legend:</h6>
                <span class="badge bg-success me-2">Approved</span>
                <span class="badge bg-warning me-2">Pending</span>
                <span class="badge bg-danger me-2">Rejected</span>
                <span class="badge bg-secondary me-2">No Entry</span>
                <span class="badge bg-light border text-danger me-2"><i class="fas fa-gift"></i> Holiday</span>
                <span class="badge bg-light border text-warning me-2">Weekend</span>
            </div>
        </div>
    </div>
</div>
{% endblock %}
