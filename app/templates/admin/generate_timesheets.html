{% extends "base.html" %}
{% block title %}Generate Timesheets{% endblock %}
{% block content %}
<h2>Generate Vendor Timesheets</h2>

<form method="POST" class="needs-validation" novalidate>
  <div class="mb-3">
    <label for="month" class="form-label">Select Month</label>
    <select id="month" name="month_year" class="form-select" required>
      <option value="">Select Month</option>
      {% for month in months %}
      <option value="{{ month }}" {% if month == filters.month_year %}selected{% endif %}>{{ month }}</option>
      {% endfor %}
    </select>
    <div class="invalid-feedback">Please select a month</div>
  </div>

  <div class="mb-3">
    <label for="vending_company" class="form-label">Select Vending Company (Optional)</label>
    <select id="vending_company" name="vending_company_id" class="form-select">
      <option value="">All Companies</option>
      {% for company in vending_companies %}
      <option value="{{ company._id }}" {% if company._id == filters.vending_company_id %}selected{% endif %}>{{ company.name }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="mb-3">
    <label for="manager" class="form-label">Select Manager (Optional)</label>
    <select id="manager" name="manager_id" class="form-select">
      <option value="">All Managers</option>
      {% for manager in managers %}
      <option value="{{ manager._id }}" {% if manager._id == filters.manager_id %}selected{% endif %}>{{ manager.name }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="alert alert-warning">
    <strong>Note:</strong> Once generated, the timesheet locks the month and prevents further data uploads or mismatch processing.
  </div>

  <button type="submit" class="btn btn-success">Generate Timesheets</button>
</form>

<script>
  // Bootstrap form validation
  (() => {
    'use strict'
    const forms = document.querySelectorAll('.needs-validation')
    Array.from(forms).forEach(form => {
      form.addEventListener('submit', event => {
        if (!form.checkValidity()) {
          event.preventDefault()
          event.stopPropagation()
        }
        form.classList.add('was-validated')
      }, false)
    })
  })()
</script>
{% endblock %}
